<!DOCTYPE html>
<html>
<head>
	<meta charset="ISO-8859-1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Iron Horse - LogOn</title>
	
	<link rel="stylesheet" href="css/bootstrap/3.2.0/bootstrap.min.css">
	<script src="js/jquery/1.11.3/jquery.min.js"></script>
	<script src="js/bootstrap/3.3.4/bootstrap.min.js"></script> 
	<script src="js/angularjs/1.3.15/angular.min.js"></script>   
</head>
<body>
<div class="container-fluid" ng-app="logonApp" ng-controller="logonCtrl">
	<div class="page-header" ng-include="'includes/header.html'"></div>
	<div class="well well-sm"><span>Logon</span></div>

<form novalidate name="logon" id="logon" class="form-horizontal" role="form" method="post">
		<div class="form-group">
			<label class="col-sm-1 control-label">User Id</label>
			<div class="col-sm-4">
				<input class="form-control" name="userId" id="userId" type="text" ng-model="userId" required/>
				<span class="help-block" ng-show="logon.userId.$error.required">User Id is required.</span>
      		</div>
      	</div>
      	<div class="form-group">
			<label class="col-sm-1 control-label">Password</label>
			<div class="col-sm-4">
				<input class="form-control" name="pwd" id="pwd" type="password" ng-model="pwd" required/>
				<span class="help-block" ng-show="logon.pwd.$error.required">Password is required.</span>
      		</div>
		</div>
		
		<div class="form-group" ng-show="errorMessage">
	    <label class="col-sm-1 control-label">Error</label>
	    <div class="col-sm-9">
	    	<div class="alert alert-danger">
          		{{ errorMessage }}
        	</div>
		</div>
		</div>
		
		<button type="button" class="btn btn-default" ng-click="onSubmit()">Submit</button>
		<button type="button" class="btn btn-default" ng-click="onReset()"">Reset</button>
	
		
</form>	


</div>

<script>
       var app = angular.module('logonApp', []);
       
       app.controller('logonCtrl', function($scope, $http) {
    	   
    	   if (typeof(Storage) !== "undefined") 
    		   $scope.coreUrl=localStorage.getItem("org.cysoft.bss.ih.coreurl");
    	   else 
    	       alert("Local storage isn't supported !");
    	
    	   
    	   
    	$scope.onSubmit = function() {
    		
    		
    		var request = '{"method": "POST","url": "'+$scope.coreUrl+'/rest/cybss-auth/logOn'+'",'; 
			"headers": {"Security-Token": "'+$scope.securityToken+'"},';
			request+='"data": {"userId":"'+$scope.userId+'","pwd":"'+$scope.pwd+'"}}';
			alert("request="+request);
			console.log("request="+request);	
			
			callWs($http,$scope,request);    		
    	}
    	 
		$scope.onReset = function() {
    		$scope.userId="";
    		$scope.pwd="";
    	}
		
       });   

       
       function callWs($http,$scope,request){
       	//window.alert("request="+request);
       	var reqObj=JSON.parse(request);
       	//window.alert("reqObj="+reqObj);
   		$http(reqObj).then(
   			function(response){
   				alert("OK !!!");
   				$scope.logon.response=JSON.stringify(response);
   				
   			}, 
   			function(response){
   				manageError($scope,response.status,response.data);
   			});
       }
       
       function manageError($scope,status,data){
       	$scope.errorMessage="Status:"+status+" - "+data;	
       }

</script>

</body>
</html>