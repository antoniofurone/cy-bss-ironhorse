<head>
	<meta charset="ISO-8859-1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Iron Horse - User</title>
	
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<script src="js/jquery/1.11.3/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script> 
	<script src="js/angularjs/1.3.15/angular.min.js"></script>
	<script src="js/angular-translate/2.8.1/angular-translate.min.js"></script>
	
	<script src="js/ironhorse-common.js"></script>
	<script src="js/ironhorse-transl.js"></script>
	   
</head>
<body>
<div class="container-fluid" ng-app="pageApp" ng-controller="pageCtrl">
	<div class="page-header" ng-include="'includes/header.html'" ></div>
	
	<form novalidate name="userList" id="userList" class="form-horizontal" role="form" method="post">
		<div id='list' ng-show="!showList">
			<div class="well well-sm"><span>{{'NEW.TITLE' | translate }}</span></div>
			<div class="form-group">
				<label class="col-sm-1 control-label">{{'USERID.LABEL' | translate }}</label>
				<div class="col-sm-4">
					<input class="form-control" name="userId" id="userId" type="text" ng-model="userId" required/>
					<span class="help-block" ng-show="userList.userId.$error.required" translate>USER_ID.REQUIRED</span>
      			</div>
      			<label class="col-sm-1 control-label">{{'NAME.LABEL' | translate }}</label>
				<div class="col-sm-4">
					<input class="form-control" name="name" id="name" type="text" ng-model="name" required/>
					<span class="help-block" ng-show="userList.name.$error.required" translate>NAME.REQUIRED</span>
      			</div>
			</div>
			<div class="form-group">
				<label class="col-sm-1 control-label">{{'PWD.LABEL' | translate }}</label>
				<div class="col-sm-4">
					<input class="form-control" name="pwd" id="pwd" type="password" ng-model="pwd" required/>
					<span class="help-block" ng-show="userList.pwd.$error.required" translate>PWD.REQUIRED</span>
      			</div>
      			<label class="col-sm-1 control-label">{{'CONFPWD.LABEL' | translate }}</label>
				<div class="col-sm-4">
					<input class="form-control" name="confPwd" id="confPwd" type="password" ng-model="confPwd" required/>
					<span class="help-block" ng-show="userList.confPwd.$error.required" translate>CONFPWD.REQUIRED</span>
      			</div>
			</div>
			<div class="form-group">
				<label class="col-sm-1 control-label">{{'ROLE.LABEL' | translate }}</label>
				<div class="col-sm-4">
		        <select id="selectedRole" name="selectedRole" class="form-control" ng-model="selectedRole" required>
		        	 <option ng-repeat="r in roles" value="{{r.id}}">{{r.name}}</option>
		        </select>
		        <span class="help-block" ng-show="userList.selectedRole.$error.required" translate>ROLE.REQUIRED</span>
      			</div>
			
				<label class="col-sm-1 control-label">{{'LANGUAGE.LABEL' | translate }}</label>
				<div class="col-sm-4">
		        <select id="selectedLanguage" name="selectedLanguage" class="form-control" ng-model="selectedLanguage" required>
		        	 <option ng-repeat="l in languages" value="{{l.id}}">{{l.name}}</option>
		        </select>
		        <span class="help-block" ng-show="userList.selectedLanguage.$error.required" translate>LANGUAGE.REQUIRED</span>
      			</div>
			</div>
			
			<button type="button" class="btn btn-default" ng-click="onSubmit()" translate>SUBMIT.BUTTON</button>
			<button type="button" class="btn btn-default" ng-click="onReset()" translate>RESET.BUTTON</button>
				
		</div>
		
		<div id='list' ng-show="showList">		
			<div class="well well-sm"><span>{{'SEARCH.TITLE' | translate }}</span></div>
				
			<div class="form-group">
				<label class="col-sm-1 control-label">{{'USERNAME.LABEL' | translate }}</label>
				<div class="col-sm-3">
					<input class="form-control" name="userName" id="userName" type="text" ng-model="userName"/>
				</div>
				<button type="button" class="btn btn-default" ng-click="onSearch()">
				<span class="glyphicon glyphicon-search"></span>
				{{'SEARCH.BUTTON' | translate }}
				</button>
				
				<button type="button" class="btn btn-default" ng-click="onNew()">
				<span class="glyphicon glyphicon-pencil"></span>&nbsp;&nbsp;
				{{'NEW.BUTTON' | translate }}
				</button>
				
			</div>
	      	
	      	<div>
			<table class="table table-striped" ng-show="users">
	      		<thead><tr>
	      			<th>UserId</th><th>Name</th>
	      			<th>Role</th><th>Language</th><th>Active</th>
	      			<th></th><th></th>
	      		</tr></thead>
	      		<tbody><tr ng-repeat="user in users">
	    		
	    		<td>{{ user.userId }}</td>
	    		<td>{{ user.name }}</td>
	    		<td>{{ user.role }}</td>
	    		<td>{{ user.languageCode }}</td>
	    		<td>{{ user.flgActive }}</td>
	    		
	    		<td>
	      			<button class="btn btn-default" ng-click="editUser(user.id)">
	      			<span class="glyphicon glyphicon-pencil"></span>&nbsp;&nbsp;Edit
	      			</button>
	    		</td>
	    		<td>
	      			<button class="btn btn-default" ng-click="deleteUser(user.id)">
	      			<span class="glyphicon glyphicon-trash"></span>&nbsp;&nbsp;Delete
	      			</button>
	    		</td>
	    		
	    		
	  			</tr></tbody>
	   		</table>
	      	</div>
	      	
      	</div>
      	<!--  end list -->
      	
		<div class="form-group" ng-show="errorMessage">
		    <label class="col-sm-1 control-label">Error</label>
		    <div class="col-sm-9">
		    	<div class="alert alert-danger">
	          		{{ errorMessage }}
	        	</div>
			</div>
		</div>
	
		
	</form>

</div>

<script>
	
	var app = angular.module('pageApp', ['pascalprecht.translate','irtranslator'])
		.config(function($translateProvider) {
	     	$translateProvider
	     	.translations('en',{
	     		'SEARCH.BUTTON':'Search',
	     		'NEW.BUTTON':'New',
	     		'USERNAME.LABEL':'User Name',
	     		'SEARCH.TITLE':'Search Users',
	     		'NEW.TITLE':'New User',
	     		'USERID.LABEL':'User Id',
	     		'USER_ID.REQUIRED':'User Id required',
	     		'PWD.LABEL':'Password',
	     		'PWD.REQUIRED':'Password required',
	     		'CONFPWD.LABEL':'Confirm Password',
	     		'CONFPWD.REQUIRED':'Confirm Password required',
	     		'NAME.LABEL':'Name',
	     		'NAME.REQUIRED':'Name required',
	     		'ROLE.LABEL':'Role',
	     		'ROLE.REQUIRED':'Role required',
	    		'LANGUAGE.LABEL':'Language',
	     		'LANGUAGE.REQUIRED':'Language required',
				'SUBMIT.BUTTON':'Submit',
    		    'RESET.BUTTON': 'Reset'
         	  })
    		  
    		.translations('it',{
    			'SEARCH.BUTTON':'Ricerca',
    			'NEW.BUTTON':'Nuovo',
    			'USERNAME.LABEL':'Nome Utente',
    			'SEARCH.TITLE':'Ricerca Utenti',
    			'NEW.TITLE':'Nuovo Utente',
    			'USERID.LABEL':'User Id',
    			'USER_ID.REQUIRED':'User Id obbligatorio',
    			'PWD.LABEL':'Password',
	     		'PWD.REQUIRED':'Password obbligatoria',
	    		'CONFPWD.LABEL':'Conferma Password',
	     		'CONFPWD.REQUIRED':'Conferma Password obbligatoria',
	     		'NAME.LABEL':'Nome',
	     		'NAME.REQUIRED':'Nome obbligatorio',
	    		'LANGUAGE.LABEL':'Lingua',
	     		'LANGUAGE.REQUIRED':'Lingua obbligatoria',
				'SUBMIT.BUTTON':'Conferma',
	    		'RESET.BUTTON': 'Reset'
	     	  });
	     	
	     	
	     	 $translateProvider.preferredLanguage(getLanguage());
	 	});
	   

	app.controller('pageCtrl', function($scope, $http,$translate) {
		$scope.showList=true;
		$scope.securityToken=getLocalStorageItem("org.cysoft.bss.ih.securityToken");
		
		$scope.onSearch = function() {
    		$scope.errorMessage="";
    		
    		callRestWs($http,'user/find?name='+($scope.userName!=undefined?encodeURIComponent($scope.userName):''),'GET',
    				'"Security-Token": "'+$scope.securityToken+'"',
    				'',
    				function(response){
   						if (response.data.resultCode==RESULT_OK){
   							//alert (JSON.stringify(response));
   							$scope.users=response.data.users;
   							//alert ($scope.users);
   						}
   						else
   						{
   							manageError($scope,response.data.resultCode,response.data.resultDesc);
   						}
   					}, 
   					function(response){
   							manageError($scope,response.status,response.data);
   					});
    		
		}
		// end search
		
		$scope.onNew = function() {
    		$scope.errorMessage="";
    		$scope.showList=false;
    		
    		
    		callRestWs($http,'language/getLanguageAll','GET',
    				'"Security-Token": "'+$scope.securityToken+'"',
    				'',
    				function(response){
   						if (response.data.resultCode==RESULT_OK){
   							//alert (JSON.stringify(response));
   							$scope.languages=response.data.languages;
   						}
   						else
   						{
   							manageError($scope,response.data.resultCode,response.data.resultDesc);
   						}
   					}, 
   					function(response){
   							manageError($scope,response.status,response.data);
   					});
    	
    	
    		callRestWs($http,'user/getRoleAll','GET',
    				'"Security-Token": "'+$scope.securityToken+'"',
    				'',
    				function(response){
   						if (response.data.resultCode==RESULT_OK){
   							//alert (JSON.stringify(response));
   							$scope.roles=response.data.roles;
   						}
   						else
   						{
   							manageError($scope,response.data.resultCode,response.data.resultDesc);
   						}
   					}, 
   					function(response){
   							manageError($scope,response.status,response.data);
   					});
    	
    		
		}
		// end new
		
		$scope.onSubmit = function() {
    		if (!$scope.logon.$valid)
    			return;

			
		}// end onSubmit
    	
		$scope.onReset = function() {
			$scope.userId='';
			$scope.name='';
			$scope.pwd='';
			$scope.confPwd='';
			$scope.selectedRole='';
			$scope.selectedLanguage='';
			
		}// end onReset
    	
		
	});   
	   
	setMenuCntl(app);
		

</script>

</body>
</html>	